<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polygonal Spiral [Idle Mechanics]</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="idle-mechanics-theme.css">
    
    <style>
        :root {
            --electric-cyan: #00FFF7;
            --primary-glyph-color: #FF1E8E;
            --dark-bg: #0D0D0D;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            overflow: hidden; 
        }
        .spiral-window {
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .spiral-svg {
            width: 100vw;
            height: 100vh;
            animation: spin 30s linear infinite;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .spiral-path {
            stroke: url(#gradient);
            fill: none;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* REMOVED: .button-wrapper styles */

    </style>
</head>
<body> 

    <!-- SVG definition for the new gradient using CSS variables -->
    <svg width="0" height="0" style="position:absolute;">
        <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:var(--electric-cyan); stop-opacity:1" />
                <stop offset="100%" style="stop-color:var(--primary-glyph-color); stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <main>
        <!-- Polygonal Spiral Window -->
        <div class="spiral-window">
             <svg class="spiral-svg" viewBox="-350 -350 700 700">
                 <path class="spiral-path" id="polygonal-path"></path>
             </svg>
        </div>
        <!-- REMOVED: Button wrapper and button element -->
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const polygonalSpiral = {
                id: 'polygonal-path',
                generator: (progress) => { 
                    let path = 'M 0,0';
                    let x = 0, y = 0;
                    const initialSegmentLength = 0.1;
                    const finalSegmentLength = 500;
                    let currentSegmentLength = initialSegmentLength + (finalSegmentLength - initialSegmentLength) * progress;
                    const initialLengthIncrease = 0.1;
                    const finalLengthIncrease = 250;
                    const currentLengthIncrease = initialLengthIncrease + (finalLengthIncrease - initialLengthIncrease) * progress;
                    const initialSegments = 1;
                    const finalSegments = 350;
                    const numSegments = initialSegments + (finalSegments - initialSegments) * progress;
                    let angle = 0;
                    const angleIncrement = Math.PI / 2;
                    for (let i = 0; i < numSegments; i++) {
                        x += currentSegmentLength * Math.cos(angle);
                        y += currentSegmentLength * Math.sin(angle);
                        path += ` L ${x},${y}`;
                        angle += angleIncrement;
                        if (i % 2 === 0) {
                            currentSegmentLength += currentLengthIncrease;
                        }
                    }
                    return path;
                }
            };

            function easeInOutCubic(t) { 
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            function triggerSpiralAnimation(config) { 
                const pathEl = document.getElementById(config.id);
                if (!pathEl) return;
                const svgElement = pathEl.closest('.spiral-svg');
                if (!svgElement) return;
                // REMOVED: modeToggleButton variable

                let startTime = null;
                const duration = 15000;
                const initialViewBoxSize = 700;
                const finalViewBoxSize = 20000;
                const initialStrokeWidth = 1;
                const finalStrokeWidth = 8;

                // REMOVED: keepSpinning and pausedAtMax variables
                let direction = 1; // 1 for growing, -1 for shrinking
                let pauseTimeoutId = null;

                // REMOVED: Button click event listener

                function animate(currentTime) {
                    // REMOVED: pausedAtMax check
                    
                    if (startTime === null) startTime = currentTime;
                    
                    let elapsedTime = currentTime - startTime;
                    let rawProgress = Math.min(elapsedTime / duration, 1);

                    const easedProgress = (direction === 1) 
                        ? easeInOutCubic(rawProgress) 
                        : easeInOutCubic(1 - rawProgress);

                    const newPathData = config.generator(easedProgress);
                    pathEl.setAttribute('d', newPathData);

                    const currentViewBoxSize = initialViewBoxSize + (finalViewBoxSize - initialViewBoxSize) * easedProgress;
                    const currentMin = -currentViewBoxSize / 2;
                    svgElement.setAttribute('viewBox', `${currentMin} ${currentMin} ${currentViewBoxSize} ${currentViewBoxSize}`);

                    const currentStrokeWidth = initialStrokeWidth + (finalStrokeWidth - initialStrokeWidth) * easedProgress;
                    pathEl.style.strokeWidth = `${currentStrokeWidth}px`;

                    // UPDATED: Simplified animation loop logic
                    if (rawProgress >= 1) {
                        if (direction === 1) { // Finished growing
                            if (!pauseTimeoutId) {
                                pauseTimeoutId = setTimeout(() => {
                                    direction = -1;
                                    startTime = null;
                                    pauseTimeoutId = null;
                                }, 5000); // 5-second pause
                            }
                        } else { // Finished shrinking
                            direction = 1;
                            startTime = null;
                        }
                    }
                    requestAnimationFrame(animate);
                }
                requestAnimationFrame(animate);
            }

            triggerSpiralAnimation(polygonalSpiral);
        });
    </script>
</body>
</html>

